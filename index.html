<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>H&H INVERSIONES S.A.S</title>
  <meta name="description" content="H&H INVERSIONES S.A.S" />

  <style>
    :root{
      --bg:#070A12;
      --text:#EAF0FF;
      --muted:rgba(234,240,255,.72);
      --line:rgba(255,255,255,.10);
      --radius:18px;
      --shadow: 0 18px 60px rgba(0,0,0,.45);

      --green:#00FFA0;
      --red:#FF465A;
      --teal:#00D2FF;
      --violet:#6C5CE7;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background: linear-gradient(180deg, #05060B, var(--bg));
      min-height:100vh;
    }
    .container{width:min(1100px,92%);margin:0 auto;padding:18px 0 44px}
    header{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:14px 0 12px;border-bottom:1px solid var(--line);
      position:sticky;top:0;z-index:20;
      background: rgba(7,10,18,.68);
      backdrop-filter: blur(10px);
    }
    .brand{display:flex;align-items:center;gap:10px;min-width:0;}
    .dot{
      width:14px;height:14px;border-radius:999px;
      background: linear-gradient(135deg, var(--violet), var(--teal));
      box-shadow: 0 12px 30px rgba(108,92,231,.28);
      flex:0 0 auto;
    }
    .brand h1{
      margin:0;
      font-size:14px;
      letter-spacing:.14em;
      text-transform:uppercase;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .btn{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color:var(--text);
      padding:10px 12px;
      border-radius:999px;
      text-decoration:none;
      font-size:13px;
      display:inline-flex;align-items:center;gap:8px;
      transition:.2s ease;
      user-select:none;
      flex:0 0 auto;
    }
    .btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,.22)}
    .card{
      margin-top:14px;
      background: rgba(255,255,255,.04);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }

    .hero{
      position:relative;
      width:100%;
      height: clamp(240px, 36vw, 390px);
      background:
        radial-gradient(900px 450px at 20% 10%, rgba(108,92,231,.22), transparent 60%),
        radial-gradient(800px 420px at 90% 30%, rgba(0,210,255,.14), transparent 55%),
        url("assets/file_00000000f9dc720ea194c9b5641c7209.png") center/cover no-repeat;
    }
    .hero::after{
      content:"";
      position:absolute;inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,.08), rgba(0,0,0,.65));
    }
    .heroText{
      position:absolute;left:18px;right:18px;bottom:16px;
      z-index:1;
      display:flex;flex-direction:column;gap:6px;
    }
    .heroText .t1{font-size: clamp(18px, 2.6vw, 28px);margin:0;letter-spacing:.02em;}
    .heroText .t2{margin:0;font-size: 13px;opacity:.82}

    .body{padding:14px}

    .embedWrap{
      position:relative;
      width:100%;
      min-height:680px;
      border-radius: 16px;
      border:1px solid var(--line);
      overflow:hidden;
      background: rgba(0,0,0,.20);
    }
    iframe{
      position:absolute; inset:0;
      width:100%; height:100%;
      border:0;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top:12px;
    }
    .mini{
      border-radius:16px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      padding:14px;
      overflow:hidden;
    }
    .label{
      font-size:12px;
      color:var(--muted);
      letter-spacing:.10em;
      text-transform:uppercase;
      margin:0 0 10px
    }
    .clock{
      font-size: clamp(22px, 3vw, 34px);
      margin:0;
      letter-spacing:.02em;
    }
    .meta{margin:8px 0 0;color:var(--muted);font-size:13px}

    .stats{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      margin-top:12px;
    }
    .stat{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius:16px;
      padding:12px;
      min-width:0;
    }
    .stat small{
      display:block;
      color:var(--muted);
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:11px;
    }
    .stat b{
      display:block;
      margin-top:6px;
      font-size:18px;
      letter-spacing:.02em;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .stat.accent{
      background: linear-gradient(135deg, rgba(0,210,255,.10), rgba(108,92,231,.10));
      border-color: rgba(0,210,255,.20);
    }

    .candleWrap{
      height: 290px;
      border-radius:14px;
      border:1px solid var(--line);
      background:
        radial-gradient(900px 340px at 40% 0%, rgba(0,210,255,.08), transparent 55%),
        radial-gradient(820px 320px at 80% 40%, rgba(108,92,231,.07), transparent 55%),
        rgba(0,0,0,.18);
      overflow:hidden;
      position:relative;
    }
    canvas{width:100%;height:100%;display:block}

    footer{
      margin-top:16px;
      padding:14px 0 0;
      border-top:1px solid var(--line);
      color: rgba(234,240,255,.62);
      font-size:12px;
    }
    footer a{
      color: rgba(234,240,255,.86);
      text-decoration:none;
      border-bottom:1px dashed rgba(234,240,255,.28);
    }
    footer a:hover{border-bottom-color: rgba(234,240,255,.55);}
    .techs{
      display:flex;
      flex-wrap:wrap;
      gap:10px 14px;
      align-items:center;
      margin-top:8px;
    }

    @media (max-width: 900px){
      .embedWrap{min-height:620px}
      .grid2{grid-template-columns:1fr}
      .stats{grid-template-columns:1fr}
      .candleWrap{height: 320px}
      header{flex-wrap:wrap}
    }

    /* ===== CHAT FLOTANTE ===== */
    .chatFab{
      position: fixed;
      right: 18px;
      bottom: 18px;
      width: 56px;
      height: 56px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(135deg, rgba(0,210,255,.22), rgba(108,92,231,.18));
      box-shadow: 0 18px 50px rgba(0,0,0,.55);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index: 9999;
      cursor:pointer;
      user-select:none;
      backdrop-filter: blur(10px);
    }
    .chatFab:active{transform: translateY(1px);}
    .chatFab .bubble{
      width: 34px;height: 34px;border-radius: 12px;
      background: linear-gradient(135deg, rgba(0,210,255,.70), rgba(108,92,231,.55));
      position:relative;
      overflow:hidden;
    }
    .chatFab .bubble:after{
      content:"";
      position:absolute;inset:-30%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), transparent 55%);
      transform: rotate(12deg);
    }
    .chatPanel{
      position: fixed;
      right: 18px;
      bottom: 86px;
      width: min(360px, calc(100vw - 36px));
      height: 440px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(7,10,18,.92);
      box-shadow: 0 20px 70px rgba(0,0,0,.60);
      display: none;
      flex-direction: column;
      overflow: hidden;
      z-index: 9999;
      backdrop-filter: blur(14px);
    }
    .chatPanel.open{display:flex;}
    .chatHeader{
      padding: 12px 12px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      background: rgba(255,255,255,.04);
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .chatHeader .left{
      display:flex;align-items:center;gap:10px;min-width:0;
    }
    .chatHeader .avatar{
      width: 34px;height: 34px;border-radius: 12px;
      background: linear-gradient(135deg, rgba(0,210,255,.70), rgba(108,92,231,.55));
      box-shadow: 0 12px 30px rgba(0,210,255,.10);
      position:relative;overflow:hidden;flex:0 0 auto;
    }
    .chatHeader .avatar:after{
      content:"";
      position:absolute;inset:-30%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), transparent 55%);
      transform: rotate(12deg);
    }
    .chatHeader .title{
      min-width:0;
      line-height:1.1;
    }
    .chatHeader .title b{
      display:block;
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
    }
    .chatHeader .title small{
      display:block;
      color: rgba(234,240,255,.65);
      font-size:12px;
      margin-top:2px;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .chatHeader button{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: rgba(234,240,255,.90);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
    }
    .chatHeader button:active{transform: translateY(1px);}

    .chatMsgs{
      flex: 1;
      overflow:auto;
      padding: 12px;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .msg{
      max-width: 86%;
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      padding: 10px 12px;
      font-size: 13px;
      line-height: 1.45;
      background: rgba(255,255,255,.03);
      color: rgba(234,240,255,.78);
    }
    .msg.user{
      margin-left:auto;
      background: rgba(0,210,255,.12);
      color: rgba(234,240,255,.92);
      text-align:right;
    }
    .msg a{
      color: rgba(234,240,255,.92);
      border-bottom: 1px dashed rgba(234,240,255,.30);
      text-decoration:none;
    }
    .msg a:hover{border-bottom-color: rgba(234,240,255,.55);}

    .chatInput{
      display:flex;
      gap: 8px;
      padding: 10px;
      border-top: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }
    .chatInput input{
      flex:1;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: rgba(234,240,255,.92);
      outline:none;
    }
    .chatInput input::placeholder{color: rgba(234,240,255,.45);}
    .chatInput button{
      padding: 10px 12px;
      border-radius: 12px;
      border: 0;
      cursor:pointer;
      color: rgba(0,0,0,.88);
      font-weight: 800;
      letter-spacing:.02em;
      background: linear-gradient(135deg, rgba(0,255,160,.95), rgba(0,210,255,.65));
    }
    .chatInput button:active{transform: translateY(1px);}
  </style>
</head>

<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="dot" aria-hidden="true"></div>
        <h1>H&amp;H INVERSIONES S.A.S</h1>
      </div>
      <a class="btn" href="#tabla">Ver tabla</a>
    </header>

    <section class="card">
      <div class="hero" role="img" aria-label="H&H INVERSIONES S.A.S">
        <div class="heroText">
          <h2 class="t1">H&amp;H INVERSIONES S.A.S</h2>
          <p class="t2">Panel</p>
        </div>
      </div>

      <div class="body" id="tabla">
        <div class="embedWrap">
          <iframe
            src="https://fuzzy-link-8ac.notion.site/ebd//2d65a8f9451080968fe1e8957527aeac?v=2d65a8f945108072a4b4000ca9929fc6"
            loading="lazy"
            allowfullscreen
          ></iframe>
        </div>

        <div class="grid2" style="margin-top:14px">
          <div class="mini">
            <p class="label">Colombia</p>
            <h3 class="clock" id="clock">--:--:--</h3>
            <p class="meta" id="clockMeta">--</p>

            <div class="stats" aria-label="Promedios">
              <div class="stat accent">
                <small>Ganancia / Hora</small>
                <b id="ph">0.1458%</b>
              </div>
              <div class="stat">
                <small>Ganancia / Día</small>
                <b id="pd">3.50%</b>
              </div>
              <div class="stat accent">
                <small>20 días</small>
                <b id="p20">70%</b>
              </div>
            </div>
          </div>

          <div class="mini">
            <p class="label">Progreso</p>
            <div class="candleWrap">
              <canvas id="candleChart"></canvas>
            </div>
          </div>
        </div>

        <footer>
          <div><b style="letter-spacing:.10em;text-transform:uppercase;font-size:11px;opacity:.9">Tecnologías</b></div>
          <div class="techs">
            <span>IA:</span>
            <a href="https://www.trendspider.com/" target="_blank" rel="noopener">TrendSpider</a>
            <a href="https://www.tradingview.com/" target="_blank" rel="noopener">TradingView</a>
            <a href="https://www.tensorflow.org/" target="_blank" rel="noopener">TensorFlow</a>
          </div>
        </footer>
      </div>
    </section>
  </div>

  <!-- ===== CHAT FLOTANTE ===== -->
  <div class="chatFab" id="chatFab" aria-label="Abrir chat">
    <div class="bubble" aria-hidden="true"></div>
  </div>

  <div class="chatPanel" id="chatPanel" aria-label="Chat BOT H&H">
    <div class="chatHeader">
      <div class="left">
        <div class="avatar" aria-hidden="true"></div>
        <div class="title">
          <b>BOT H&amp;H</b>
          <small>Alertas sobre patrones de compra y venta</small>
        </div>
      </div>
      <button id="chatClose" aria-label="Cerrar">Cerrar</button>
    </div>

    <div class="chatMsgs" id="chatMsgs">
      <div class="msg">
        Soy un bot creado por H&amp;H para alertar sobre patrones de compra y venta de beneficio.
      </div>
    </div>

    <div class="chatInput">
      <input id="chatInput" type="text" placeholder="Escribe tu pregunta..." autocomplete="off" />
      <button id="chatSend">Enviar</button>
    </div>
  </div>

  <script>
    // ====== RELOJ COLOMBIA ======
    const tz = "America/Bogota";
    const clockEl = document.getElementById("clock");
    const metaEl  = document.getElementById("clockMeta");

    function tickClock(){
      const now = new Date();
      const time = new Intl.DateTimeFormat("es-CO", {
        timeZone: tz, hour: "2-digit", minute: "2-digit", second: "2-digit", hour12: false
      }).format(now);

      const date = new Intl.DateTimeFormat("es-CO", {
        timeZone: tz, weekday: "long", year: "numeric", month: "long", day: "2-digit"
      }).format(now);

      clockEl.textContent = time;
      metaEl.textContent = date;
    }
    tickClock();
    setInterval(tickClock, 1000);

    // ====== PROMEDIOS EXACTOS (70% en 20 días) ======
    const total20 = 70;
    const hours = 20 * 24;
    const perHourPct = total20 / hours;
    const perDayPct  = total20 / 20;

    document.getElementById("ph").textContent  = `${perHourPct.toFixed(4)}%`;
    document.getElementById("pd").textContent  = `${perDayPct.toFixed(2)}%`;
    document.getElementById("p20").textContent = `${total20}%`;

    // ====== CHAT FLOTANTE (respuesta SOLO después de preguntar) ======
    const chatFab   = document.getElementById("chatFab");
    const chatPanel = document.getElementById("chatPanel");
    const chatClose = document.getElementById("chatClose");
    const chatMsgs  = document.getElementById("chatMsgs");
    const chatInput = document.getElementById("chatInput");
    const chatSend  = document.getElementById("chatSend");

    const waLink = "https://wa.me/573017868056";
    const botReplyHTML = `
      <div class="msg">
        Entiendo. Para mayor información contacta a soporte:
        <a href="${waLink}" target="_blank" rel="noopener noreferrer">WhatsApp +57 301 7868056</a>
      </div>
    `;

    function openChat(){ chatPanel.classList.add("open"); setTimeout(()=>chatInput.focus(), 50); }
    function closeChatPanel(){ chatPanel.classList.remove("open"); }

    chatFab.addEventListener("click", () => {
      chatPanel.classList.contains("open") ? closeChatPanel() : openChat();
    });
    chatClose.addEventListener("click", closeChatPanel);

    function pushUserMessage(text){
      const safe = text.replace(/</g,"&lt;").replace(/>/g,"&gt;");
      chatMsgs.insertAdjacentHTML("beforeend", `<div class="msg user">${safe}</div>`);
      chatMsgs.scrollTop = chatMsgs.scrollHeight;
    }
    function pushBotReply(){
      chatMsgs.insertAdjacentHTML("beforeend", botReplyHTML);
      chatMsgs.scrollTop = chatMsgs.scrollHeight;
    }
    function sendChat(){
      const text = (chatInput.value || "").trim();
      if (!text) return;
      pushUserMessage(text);
      chatInput.value = "";
      setTimeout(pushBotReply, 450);
    }
    chatSend.addEventListener("click", sendChat);
    chatInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") { e.preventDefault(); sendChat(); }
    });

    // ====== CANVAS VELAS (secuencia + eje horas + 2 rojas por cada 10 verdes) ======
    const canvas = document.getElementById("candleChart");
    const ctx = canvas.getContext("2d");

    function roundedRectPath(x, y, w, h, r){
      r = Math.max(0, Math.min(r, w/2, h/2));
      ctx.beginPath();
      ctx.moveTo(x+r, y);
      ctx.arcTo(x+w, y, x+w, y+h, r);
      ctx.arcTo(x+w, y+h, x, y+h, r);
      ctx.arcTo(x, y+h, x, y, r);
      ctx.arcTo(x, y, x+w, y, r);
      ctx.closePath();
    }

    function fitCanvas(){
      const rect = canvas.getBoundingClientRect();
      if (!rect.width || !rect.height) return false;
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      canvas.width  = Math.floor(rect.width * dpr);
      canvas.height = Math.floor(rect.height * dpr);
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      return true;
    }

    function mulberry32(a){
      return function(){
        let t = a += 0x6D2B79F5;
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      };
    }

    // Formato de hora en Colombia
    const fmtHour = new Intl.DateTimeFormat("es-CO", { timeZone: tz, hour: "2-digit", hour12: false });

    let STATE = { candles: [], N: 36, hourStart: null };

    function pickTwoRedIndices(seed){
      // elige 2 índices únicos (0..11) determinísticamente
      const rnd = mulberry32(seed);
      const a = Math.floor(rnd() * 12);
      let b = Math.floor(rnd() * 12);
      while (b === a) b = Math.floor(rnd() * 12);
      return new Set([a,b]);
    }

    function buildCandlesBase(){
      const N = STATE.N;
      const now = new Date();

      // ✅ NO FUTURO: cerramos a la hora actual (inicio de hora)
      const hourStart = new Date(now);
      hourStart.setMinutes(0,0,0);
      STATE.hourStart = hourStart;

      // Tendencia “creíble” (lineal) + oscilación, pero con ratio EXACTO de rojas
      const driftUp = 0.11;     // avance promedio por hora
      const greenVol = 0.35;    // variación en verdes
      const redVol = 0.30;      // variación en rojas
      const redBase = 0.22;     // caída mínima en rojas

      let value = 100;
      const candles = [];

      // bloques de 12: 10 verdes + 2 rojas (aleatorias dentro del bloque)
      const blocks = Math.ceil(N / 12);

      for (let block = 0; block < blocks; block++){
        const blockSeed = Math.floor((hourStart.getTime() / 3600_000)) + block * 1013;
        const redSet = pickTwoRedIndices(blockSeed);

        for (let j = 0; j < 12; j++){
          const idx = block * 12 + j;
          if (idx >= N) break;

          // fecha/hora de la vela idx (de más antigua -> más reciente)
          const hoursBack = (N - 1) - idx;
          const t = new Date(hourStart.getTime() - hoursBack * 3600_000);

          // seed por vela (para que sea “secuencia” estable)
          const candleSeed = Math.floor(t.getTime()/3600_000);
          const rnd = mulberry32(candleSeed);

          const open = value;
          const isRed = redSet.has(j);

          let delta;
          if (isRed){
            // roja: caída lógica (puede ser pequeña o mediana)
            delta = -(redBase + rnd() * redVol);
          } else {
            // verde: subida promedio con variación (no exponencial)
            delta = driftUp + (rnd() - 0.5) * greenVol;
            // a veces verde muy pequeña (casi plana) para realismo
            if (rnd() < 0.18) delta *= 0.35;
            // evita que un “verde” termine rojo por ruido
            if (delta < 0.03) delta = 0.03 + rnd()*0.06;
          }

          const closeTarget = open + delta;

          // mechas
          const hiPad = (rnd() * 0.55 + 0.18);
          const loPad = (rnd() * 0.55 + 0.18);

          const close = closeTarget;
          const high = Math.max(open, close) + hiPad;
          const low  = Math.min(open, close) - loPad;

          candles.push({
            open, close, high, low,
            closeTarget, hiPad, loPad,
            t,
            hourLabel: fmtHour.format(t) + ":00"
          });

          value = closeTarget;
        }
      }

      STATE.candles = candles;
    }

    function applyLiveProgress(){
      if (!STATE.candles.length) return;

      const now = new Date();
      const last = STATE.candles[STATE.candles.length - 1];

      // vela actual: progreso dentro de la hora (no acelera)
      const secondsIntoHour = now.getMinutes()*60 + now.getSeconds();
      const progress = secondsIntoHour / 3600;

      last.close = last.open + (last.closeTarget - last.open) * progress;
      last.high  = Math.max(last.open, last.close) + last.hiPad;
      last.low   = Math.min(last.open, last.close) - last.loPad;
    }

    function getMinMax(candles){
      let min = Infinity, max = -Infinity;
      for (const c of candles){
        min = Math.min(min, c.low);
        max = Math.max(max, c.high);
      }
      const pad = (max - min) * 0.12;
      return { min: min - pad, max: max + pad };
    }

    function drawPill(x, y, text, kind){
      ctx.font = "800 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
      const padX = 10;
      const w = ctx.measureText(text).width + padX*2;
      const h = 28;

      const bg = (kind === "buy") ? "rgba(0,255,160,0.92)" : "rgba(255,70,90,0.92)";
      const fg = "rgba(0,0,0,0.85)";

      roundedRectPath(x - w/2, y - h/2, w, h, 10);
      ctx.fillStyle = bg;
      ctx.fill();
      ctx.strokeStyle = "rgba(255,255,255,0.18)";
      ctx.lineWidth = 1;
      ctx.stroke();

      ctx.fillStyle = fg;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText(text, x, y+0.5);
    }

    function drawCandles(candles){
      const rect = canvas.getBoundingClientRect();
      const w = rect.width;
      const h = rect.height;
      ctx.clearRect(0,0,w,h);

      const padX = 14, padY = 12;

      // Reservas abajo: eje horas + pills
      const axisReserve = 22;  // espacio para hora
      const pillReserve = 38;  // espacio para COMPRA/VENTA
      const bottomReserve = axisReserve + pillReserve;

      const innerW = w - padX*2;
      const innerH = h - padY*2 - bottomReserve;

      // grid (solo zona de gráfico)
      ctx.globalAlpha = 0.18;
      ctx.strokeStyle = "rgba(255,255,255,0.16)";
      ctx.lineWidth = 1;
      for (let i=1; i<=4; i++){
        const y = padY + (innerH/5)*i;
        ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(w, y); ctx.stroke();
      }
      for (let i=1; i<=6; i++){
        const x = padX + (innerW/7)*i;
        ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, padY + innerH); ctx.stroke();
      }
      ctx.globalAlpha = 1;

      const n = candles.length;
      const step = innerW / n;
      const bodyW = Math.max(7, Math.min(14, step * 0.62));

      const {min, max} = getMinMax(candles);
      const mapY = (v) => padY + (1 - (v - min) / (max - min)) * innerH;

      // velas
      for (let i=0; i<n; i++){
        const c = candles[i];
        const x = padX + i*step + (step/2);

        const yOpen = mapY(c.open);
        const yClose = mapY(c.close);
        const yHigh = mapY(c.high);
        const yLow  = mapY(c.low);

        const up = c.close >= c.open;

        ctx.save();
        ctx.shadowBlur = 14;
        ctx.shadowColor = up ? "rgba(0,255,160,0.26)" : "rgba(255,70,90,0.26)";

        // wick
        ctx.lineWidth = 2;
        ctx.strokeStyle = up ? "rgba(0,255,160,0.85)" : "rgba(255,70,90,0.85)";
        ctx.beginPath(); ctx.moveTo(x, yHigh); ctx.lineTo(x, yLow); ctx.stroke();

        // body
        const top = Math.min(yOpen, yClose);
        const bot = Math.max(yOpen, yClose);
        const bodyH = Math.max(5, bot - top);

        const grad = ctx.createLinearGradient(0, top, 0, bot);
        if (up){
          grad.addColorStop(0, "rgba(0,255,160,0.95)");
          grad.addColorStop(1, "rgba(0,210,255,0.26)");
        } else {
          grad.addColorStop(0, "rgba(255,70,90,0.95)");
          grad.addColorStop(1, "rgba(255,70,90,0.24)");
        }

        ctx.fillStyle = grad;
        ctx.strokeStyle = up ? "rgba(0,255,160,0.95)" : "rgba(255,70,90,0.95)";
        ctx.lineWidth = 1;

        roundedRectPath(x - bodyW/2, top, bodyW, bodyH, 4);
        ctx.fill();
        ctx.stroke();

        ctx.restore();
      }

      // ===== EJE X: Horas (sin futuras, todas <= ahora) =====
      const axisY = padY + innerH + 12; // zona inferior
      ctx.strokeStyle = "rgba(255,255,255,0.18)";
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(padX, axisY);
      ctx.lineTo(w - padX, axisY);
      ctx.stroke();

      // ticks cada 4 velas (ajusta si quieres)
      ctx.font = "600 11px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
      ctx.fillStyle = "rgba(234,240,255,0.58)";
      ctx.textAlign = "center";
      ctx.textBaseline = "top";

      const tickEvery = 4;
      for (let i = 0; i < n; i += tickEvery){
        const x = padX + i*step + (step/2);
        ctx.strokeStyle = "rgba(255,255,255,0.16)";
        ctx.beginPath();
        ctx.moveTo(x, axisY - 4);
        ctx.lineTo(x, axisY + 4);
        ctx.stroke();

        const label = candles[i].hourLabel;
        ctx.fillText(label, x, axisY + 6);
      }

      // ===== Labels fijos (indicadores) =====
      const yLbl = h - 20;
      drawPill(padX + 70, yLbl, "VENTA", "sell");
      drawPill(w - padX - 70, yLbl, "COMPRA", "buy");
    }

    function renderAll(){
      if (!fitCanvas()){
        setTimeout(renderAll, 250);
        return;
      }
      buildCandlesBase();
      applyLiveProgress();
      drawCandles(STATE.candles);
    }

    function tickLive(){
      if (!STATE.candles.length) return;
      if (!fitCanvas()) return;
      applyLiveProgress();
      drawCandles(STATE.candles);
    }

    window.addEventListener("load", () => {
      renderAll();
      setInterval(renderAll, 20000); // re-genera cada 20s (misma secuencia por hora)
      setInterval(tickLive, 1000);   // anima solo la vela actual
    });
    window.addEventListener("resize", renderAll);
  </script>
</body>
</html>